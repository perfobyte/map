(()=>{var S=Math.PI,oe=S/180,A=oe/2,M=S/4,R=180/S;var L={passive:!1};var e=(t=>{var n=-t,r=1.15,o={scale_step:r,scale_step_back:1/r,max_scale:50,min_scale:0,min_x:0,min_y:0,max_x:0,max_y:0,lineWidth:.2,lastX:0,lastY:0,dirty:!0,WORLD_W:360,WORLD_H:180,width:0,height:0,w2:0,h2:0,mw2:0,mh2:0,w_w2:0,h_h2:0,x:0,y:0,s:1,maxLat:t,mMaxLat:n,maxLatMore:-(Math.log(Math.tan(M+t*A))*R),maxLatLess:-(Math.log(Math.tan(M+n*A))*R)};return o})(85.05112878);var E={mode:0};var q={sea:"#a8dadc",border_country:"#1d3557",bg_country:"#f1faee"};var i=document.getElementById("main"),Z=i.getContext("2d"),Y=document.getElementById("debug_panel"),B=Y.classList,H=document.getElementById("reset"),ee=Y.querySelector('[data-a="x"]'),te=Y.querySelector('[data-a="y"]'),re=Y.querySelector('[data-a="s"]');var z=t=>{var n=t.currentTarget,r=n.innerWidth,o=n.innerHeight,s=0,a=0,f=e.s,m=e.WORLD_W,l=e.WORLD_H;return e.max_x=m-r/f,e.max_y=l-o/f,e.min_scale=Math.min(r/m,o/l),e.w_w2=r-(s=(e.width=i.width=r)/2),e.h_h2=o-(a=(e.height=i.height=o)/2),e.mw2=-(e.w2=s),e.mh2=-(e.h2=a),e.dirty=!0};var D=()=>(e.x=e.y=0,e.dirty=!0,e.s=Math.min(i.clientWidth/e.WORLD_W,i.clientHeight/e.WORLD_H));var F=t=>{var n=t.currentTarget.querySelector("use"),r=E.mode,o=t.view;return r===1?(H.removeEventListener("click",X),i.removeEventListener("wheel",h,L),o.removeEventListener("mousedown",O),o.removeEventListener("mouseup",T),E.mode=0,B.remove("a"),n.setAttribute("href","#pause_i")):(g(t),h(t),H.addEventListener("click",X),i.addEventListener("wheel",h,L),o.addEventListener("mousedown",O),o.addEventListener("mouseup",T),E.mode=1,B.add("a"),n.setAttribute("href","#play_i"))};var X=t=>(g(t),h(t));var I=t=>{var n=0,r=0,o=0;return e.x=e.x-((n=t.clientX)-e.lastX)/(o=e.s),e.y=e.y-((r=t.clientY)-e.lastY)/o,e.lastX=n,e.lastY=r,e.dirty=!0};var g=t=>(ee.textContent=e.x,te.textContent=e.y);var $=t=>(e.lastX=t.clientX,e.lastY=t.clientY,t.view.addEventListener("mousemove",I));var O=t=>{var n=t.view;return n.addEventListener("mousemove",g)};var N=t=>t.view.removeEventListener("mousemove",I);var T=t=>{var n=t.view;return n.removeEventListener("mousemove",g)};var G=t=>{var n=t.currentTarget,r=n.getBoundingClientRect(),o=t.clientX-r.left,s=t.clientY-r.top,a=0,f=o-e.w2,m=s-e.h2,l=e.x,u=e.y,_=f/(a=e.s)+l,y=m/a+u,p=f/(e.s=a=a*(t.deltaY>0?e.scale_step_back:e.scale_step))+l,x=m/a+u;return t.preventDefault(),e.x=l+(_-p),e.y=u+(y-x),e.dirty=!0};var h=t=>re.textContent=e.s;var J=(t,n,r,o,s,a,f,m,l,u,_,y)=>{var p=0,x=0,k=0,C=0,c=0,b=0,d=0,j=0,v=null,w=null,P=null,V=null,W=null,ie="";for(r.fillStyle=_.sea,r.fillRect(0,0,o,s),r.strokeStyle=_.border_country,r.lineWidth=y,r.beginPath(),C=t.length;k<C;k++)if(W=t[k],W.k===0)for(c=0,b=(P=W.projected).length;c<b;c++){for(r.moveTo(((w=(v=P[c])[0])[0]-f)*a+l,(w[1]-m)*a+u),d=1,j=v.length;d<j;d++)r.lineTo(((w=v[d])[0]-f)*a+l,(w[1]-m)*a+u);r.closePath()}else for(x=(P=W.projected).length,p=0;p<x;p++)for(c=0,b=(V=P[p]).length;c<b;c++){for(r.moveTo(((w=(v=V[c])[0])[0]-f)*a+l,(w[1]-m)*a+u),d=1,j=v.length;d<j;d++)r.lineTo((v[d][0]-f)*a+l,(v[d][1]-m)*a+u);r.closePath()}return r.fillStyle=_.bg_country,r.fill(),r.stroke()};var K=(t,n,r,o,s,a,f,m)=>(t[0]=s/o+n,t[1]=a/o+r,t[2]=f/o+n,t[3]=m/o+r,t);var Q=t=>t.json();var U=((t,n,r,o,s,a,f)=>{var m=new AbortController,l={method:"GET",signal:m.signal},u=x=>x.name==="AbortError"||0,_=null,y=x=>n(x,o,s,t.width,t.height,t.s,t.x,t.y,t.w2,t.h2,a,t.lineWidth),p=x=>{var k=0,C=0,c=0,b=null;return e.dirty&&(l.signal.aborted||m.abort(),l.signal=(m=new AbortController).signal,_?y(_):fetch(`/_/${t.x}/${t.y}/${t.s}`,l).then(f).then(d=>{y(_=d)}).catch(u),e.dirty=!1),requestAnimationFrame(p)};return p})(e,J,K,i,Z,q,Q);i.addEventListener("mousedown",$),i.addEventListener("wheel",G,L),window.addEventListener("resize",z),window.addEventListener("mouseup",N),document.getElementById("debug").onclick=F,document.getElementById("reset").onclick=D,window.dispatchEvent(new Event("resize")),D(),requestAnimationFrame(U);})();
//# sourceMappingURL=1.js.map
