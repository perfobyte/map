(()=>{var M=Math.PI,C=M/180,R=C/2,ce=M/2,S=M/4,D=180/M;var H={},oe=1024,ae=1,ne=(e,o,r)=>`/f/application/json/tiles/${r}/${e}/${o}.json`,j={passive:!1};var t=(e=>{var o=-e,r=1.15,a={scale_step:r,scale_step_back:1/r,max_scale:50,min_scale:0,min_x:0,min_y:0,max_x:0,max_y:0,lineWidth:.2,lastX:0,lastY:0,dirty:!0,WORLD_W:360,WORLD_H:180,width:0,height:0,w2:0,h2:0,mw2:0,mh2:0,w_w2:0,h_h2:0,x:0,y:0,s:1,maxLat:e,mMaxLat:o,maxLatMore:-(Math.log(Math.tan(S+e*R))*D),maxLatLess:-(Math.log(Math.tan(S+o*R))*D)};return a})(85.05112878);var k={mode:0};var N={sea:"#a8dadc",border_country:"#1d3557",bg_country:"#f1faee"};var i=document.getElementById("main"),me=i.getContext("2d"),O=document.getElementById("debug_panel"),$=O.classList,F=document.getElementById("reset"),le=O.querySelector('[data-a="x"]'),ie=O.querySelector('[data-a="y"]'),fe=O.querySelector('[data-a="s"]');var G=e=>{var o=e.currentTarget,r=o.innerWidth,a=o.innerHeight,s=0,n=0,f=t.s,m=t.WORLD_W,l=t.WORLD_H;return t.max_x=m-r/f,t.max_y=l-a/f,t.min_scale=Math.min(r/m,a/l),t.w_w2=r-(s=(t.width=i.width=r)/2),t.h_h2=a-(n=(t.height=i.height=a)/2),t.mw2=-(t.w2=s),t.mh2=-(t.h2=n),t.dirty=!0};var T=()=>(t.x=t.y=0,t.dirty=!0,t.s=Math.min(i.clientWidth/t.WORLD_W,i.clientHeight/t.WORLD_H));var J=e=>{var o=e.currentTarget.querySelector("use"),r=k.mode,a=e.view;return r===1?(F.removeEventListener("click",q),i.removeEventListener("wheel",I,j),a.removeEventListener("mousedown",z),a.removeEventListener("mouseup",B),k.mode=0,$.remove("a"),o.setAttribute("href","#pause_i")):(y(e),I(e),F.addEventListener("click",q),i.addEventListener("wheel",I,j),a.addEventListener("mousedown",z),a.addEventListener("mouseup",B),k.mode=1,$.add("a"),o.setAttribute("href","#play_i"))};var q=e=>(y(e),I(e));var W=e=>{var o=0,r=0,a=0;return t.x=t.x-((o=e.clientX)-t.lastX)/(a=t.s),t.y=t.y-((r=e.clientY)-t.lastY)/a,t.lastX=o,t.lastY=r,t.dirty=!0};var y=e=>(le.textContent=t.x,ie.textContent=t.y);var K=e=>(t.lastX=e.clientX,t.lastY=e.clientY,e.view.addEventListener("mousemove",W));var z=e=>{var o=e.view;return o.addEventListener("mousemove",y)};var Q=e=>e.view.removeEventListener("mousemove",W);var B=e=>{var o=e.view;return o.removeEventListener("mousemove",y)};var U=e=>{var o=e.currentTarget,r=o.getBoundingClientRect(),a=e.clientX-r.left,s=e.clientY-r.top,n=0,f=a-t.w2,m=s-t.h2,l=t.x,_=t.y,w=f/(n=t.s)+l,P=m/n+_,c=f/(t.s=n=Math.max(ae,Math.min(oe,n*(e.deltaY>0?t.scale_step_back:t.scale_step))))+l,p=m/n+_;return e.preventDefault(),t.x=l+(w-c),t.y=_+(P-p),t.dirty=!0};var I=e=>fe.textContent=t.s;var V=(e,o,r,a,s,n,f,m,l,_,w,P)=>{var c=0,p=0,A=0,b=0,d=0,g=0,u=0,h=0,x=null,v=null,L=null,Y=null,E=null,xe="";for(r.fillStyle=w.sea,r.fillRect(0,0,a,s),r.strokeStyle=w.border_country,r.lineWidth=P,r.beginPath(),b=e.length;A<b;A++)if(E=e[A],E.k===0)for(d=0,g=(L=E.projected).length;d<g;d++){for(r.moveTo(((v=(x=L[d])[0])[0]-f)*n+l,(v[1]-m)*n+_),u=1,h=x.length;u<h;u++)r.lineTo(((v=x[u])[0]-f)*n+l,(v[1]-m)*n+_);r.closePath()}else for(p=(L=E.projected).length,c=0;c<p;c++)for(d=0,g=(Y=L[c]).length;d<g;d++){for(r.moveTo(((v=(x=Y[d])[0])[0]-f)*n+l,(v[1]-m)*n+_),u=1,h=x.length;u<h;u++)r.lineTo((x[u][0]-f)*n+l,(x[u][1]-m)*n+_);r.closePath()}return r.fillStyle=w.bg_country,r.fill(),r.stroke()};var Z=(e,o,r,a,s,n,f,m)=>(e[0]=s/a+o,e[1]=n/a+r,e[2]=f/a+o,e[3]=m/a+r,e);var ee=e=>e.json();var ue=()=>null;var X=(e,o)=>Math.floor((e+180)/360*o);var te=(e,o,r)=>Math.floor((1-Math.log(Math.tan(e)+1/Math.cos(e))/r)/2*o);var re=((e,o,r,a,s,n,f)=>{var m=new AbortController,l={method:"GET",signal:m.signal},_=[0,0,0,0],w=p=>p.name==="AbortError"||console.error(p),P=p=>o(p.flat(),a,s,e.width,e.height,e.s,e.x,e.y,e.w2,e.h2,n,e.lineWidth),c=p=>(t.dirty&&((A=>{var b=r(_,e.x,e.y,A,e.mw2,e.mh2,e.w_w2,e.h_h2),d=Math.floor(Math.log2(A)),g=Math.pow(2,d),u=X(b[0],g),h=0,x=te(b[1]*C,g,M),v=X(b[2],g),L=X(b[3]*C,g,M),Y=0,E=(H.length=(v-u)*(x-L),Array.from(H,ue));for(l.signal.aborted||m.abort(),l.signal=(m=new AbortController).signal;u<=v;u++)for(h=L;h<=x;h++)E[Y++]=fetch(ne(u,h,d),l).then(f);return Promise.all(E)})(e.s).then(P).catch(w),t.dirty=!1),requestAnimationFrame(c));return c})(t,V,Z,i,me,N,ee);i.addEventListener("mousedown",K),i.addEventListener("wheel",U,j),window.addEventListener("resize",G),window.addEventListener("mouseup",Q),document.getElementById("debug").onclick=J,document.getElementById("reset").onclick=T,window.dispatchEvent(new Event("resize")),T(),requestAnimationFrame(re);})();
//# sourceMappingURL=1.js.map
